import{d as q,r as V,a as H,p as M,H as Q,e as u,c as I,o as b,b as a,w as r,z as f,h as _,k as m,i as w,F as G,y as J,q as K,t as L,A as v,O as c,Q as W,x as X}from"./index-CDtMGLGq.js";import{u as Y,C as Z,g as ee,d as te,s as ae}from"./index-B7bU3Lwl.js";const le=["onClick"],de=q({__name:"index",setup(re){const n=Y();let g=V([]),p=V(!1),N=V();const t=H({id:void 0,attrName:"",categoryId:void 0,categoryLevel:void 0,attrValueList:[]}),A=()=>{t.id=void 0,t.attrName="",t.categoryId=void 0,t.categoryLevel=void 0,t.attrValueList=[]},y=async(e,l,s)=>{const d=await ee(e,l,s);d.code===200?g.value=d.data:c.error(d.message)};M(()=>n.c3Id,async e=>{g.value=[],p.value=!1,e!==void 0&&y(n.c1Id,n.c2Id,e)}),Q(()=>{n.$reset()});const h=()=>{A(),p.value=!0,Object.assign(t,{categoryId:n.c3Id,categoryLevel:3})},k=e=>{A(),p.value=!0,Object.assign(t,W.cloneDeep(e))},E=async e=>{await te(e).then(l=>{l.code===200?(c.success(l.message),y(n.c1Id,n.c2Id,n.c3Id)):c.error(l.message)})},$=()=>{p.value=!1},B=()=>{t.attrValueList.push({id:void 0,valueName:"",attrId:t.id,isEdit:!0})},S=e=>{t.attrValueList.splice(e,1)},D=async()=>{if(t.attrName.trim().length===0){c.error("属性名称不能为空");return}for(let e=0;e<t.attrValueList.length;e++)if(t.attrValueList[e].valueName.trim().length===0){c.error("第"+(e+1)+"行属性值不能为空");return}await ae(t).then(e=>{e.code===200?(c.success("保存成功"),y(n.c1Id,n.c2Id,n.c3Id),p.value=!1):c.error(e.message)})},P=e=>{if(t.attrValueList[e].valueName.trim().length===0){c.error("属性值不能为空");return}t.attrValueList[e].isEdit=!1},U=e=>{t.attrValueList[e].isEdit=!0},F=e=>{X(()=>{e.focus()})};return(e,l)=>{const s=u("el-button"),d=u("el-table-column"),z=u("el-tag"),O=u("el-popconfirm"),x=u("el-table"),C=u("el-input"),T=u("el-form-item"),j=u("el-form"),R=u("el-card");return b(),I("div",null,[a(Z),a(R,null,{default:r(()=>[a(s,{type:"primary",icon:"Plus",disabled:_(n).c3Id===void 0,onClick:h},{default:r(()=>l[1]||(l[1]=[m(" 添加品牌属性 ")])),_:1},8,["disabled"]),f(w("div",null,[a(x,{data:_(g),"header-cell-style":{textAlign:"center"},"cell-style":{textAlign:"center"},border:"",style:{margin:"10px 0"}},{default:r(()=>[a(d,{prop:"id",label:"序号",width:"80px"}),a(d,{prop:"attrName",label:"属性名称",width:"120px"}),a(d,{prop:"attrValueList",label:"属性值名称"},{default:r(o=>[(b(!0),I(G,null,J(o.row.attrValueList,i=>(b(),K(z,{key:i.id,style:{"margin-right":"10px"}},{default:r(()=>[m(L(i.valueName),1)]),_:2},1024))),128))]),_:1}),a(d,{prop:"name",label:"操作",width:"200px"},{default:r(o=>[a(s,{type:"warning",size:"small",icon:"Edit",onClick:i=>k(o.row)},{default:r(()=>l[2]||(l[2]=[m(" 编辑 ")])),_:2},1032,["onClick"]),a(O,{title:"你确定要删除吗？",onConfirm:i=>E(o.row.id)},{reference:r(()=>[a(s,{type:"danger",size:"small",icon:"Delete"},{default:r(()=>l[3]||(l[3]=[m(" 删除 ")])),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[v,!_(p)]]),f(w("div",null,[a(j,{ref_key:"addAttrFormRef",ref:N,model:t,style:{margin:"20px 0"}},{default:r(()=>[a(T,{label:"属性名称",prop:"name"},{default:r(()=>[a(C,{modelValue:t.attrName,"onUpdate:modelValue":l[0]||(l[0]=o=>t.attrName=o),placeholder:"请输入属性名称"},null,8,["modelValue"])]),_:1}),a(s,{type:"primary",icon:"Plus",disabled:t.attrName.trim().length===0,onClick:B},{default:r(()=>l[4]||(l[4]=[m(" 添加属性值 ")])),_:1},8,["disabled"]),a(s,{type:"primary",onClick:$},{default:r(()=>l[5]||(l[5]=[m("取消")])),_:1}),a(x,{border:"",style:{margin:"20px 0"},data:t.attrValueList},{default:r(()=>[a(d,{type:"index",label:"序号",width:"80"}),a(d,{label:"属性值名称"},{default:r(o=>[f(a(C,{modelValue:o.row.valueName,"onUpdate:modelValue":i=>o.row.valueName=i,onBlur:i=>P(o.$index),ref:F},null,8,["modelValue","onUpdate:modelValue","onBlur"]),[[v,o.row.isEdit]]),f(w("div",{onClick:i=>U(o.$index)},L(o.row.valueName),9,le),[[v,!o.row.isEdit]])]),_:1}),a(d,{label:"操作",width:"160px"},{default:r(o=>[a(s,{type:"danger",icon:"Delete",onClick:i=>S(o.$index)},{default:r(()=>l[6]||(l[6]=[m(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),a(s,{type:"primary",onClick:D,disabled:t.attrValueList.length===0},{default:r(()=>l[7]||(l[7]=[m(" 保存 ")])),_:1},8,["disabled"])]),_:1},8,["model"])],512),[[v,_(p)]])]),_:1})])}}});export{de as default};
