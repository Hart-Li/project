import{K as C,d as te,r as n,B as ae,e as u,c as se,o as re,b as l,w as o,k as m,h as i,N as P,U as k,O as f,P as I}from"./index-CDtMGLGq.js";const ne=(d,b,y)=>C.get(`/admin/acl/role/${d}/${b}?roleName=${y}`),ie=d=>d.id?C.put("/admin/acl/role/update",d):C.post("/admin/acl/role/save",d),de=d=>C.delete(`/admin/acl/role/remove/${d}`),ue=d=>C.get(`/admin/acl/permission/toAssign/${d}`),me=d=>C.post("/admin/acl/permission/doAssignAcl",d),fe=te({__name:"index",setup(d){const b=n(),y=n({roleName:""});let h=n(1),w=n(10),U=n(0),x=n([]);const _=async()=>{const t=await ne(h.value,w.value,y.value.roleName);t.code===k?(U.value=t.data.total,x.value=t.data.items):f.error("获取角色列表失败")};ae(()=>{_()});const F=()=>{_()},K=()=>{b.value.resetFields(),_()},D=()=>({id:void 0,roleName:""});let r=n(D()),v=n(!1),z=n();const B={roleName:[{required:!0,validator:(t,e,a)=>{e.trim()===""?a(new Error("请输入角色名称")):a()},trigger:"blur"}]},L=()=>{r.value=D(),v.value=!0},M=t=>{r.value=I.cloneDeep(t),v.value=!0},T=async t=>{(await de(t.id)).code===k?(f.success("删除角色成功"),_()):f.error("删除角色失败")},j=t=>{w.value=t,_()},G=t=>{h.value=t,_()},S=()=>{v.value=!1},H=async()=>{z.value.validate(async t=>{t?(r.value.roleName=r.value.roleName.trim(),(await ie(r.value)).code===k?(f.success("保存角色成功"),_(),v.value=!1):f.error("保存角色失败")):f.error("请检查输入的数据是否合法")})};let p=n(!1),N=n(),O=n([]),$=n([]);const J={children:"children",label:"name"},A=t=>{const e=[];return t.forEach(a=>{a.select&&(!a.children||a.children.length==0)&&e.push(a.id),a.children&&a.children.length>0&&e.push(...A(a.children))}),e},Q=async t=>{r.value=t;const e=await ue(t.id);e.code===k?(O.value=e.data.children,$.value=A(e.data.children),p.value=!0):f.error("获取角色权限失败")},W=async()=>{const t=N.value.getCheckedKeys(),e=N.value.getHalfCheckedKeys(),a=I.uniq([...t,...e]);(await me({roleId:r.value.id,permissionIdList:a})).code===k?(f.success("分配角色权限成功"),p.value=!1):f.error("分配角色权限失败")};return(t,e)=>{const a=u("el-input"),g=u("el-form-item"),c=u("el-button"),V=u("el-form"),q=u("el-card"),R=u("el-table-column"),X=u("el-popconfirm"),Y=u("el-table"),Z=u("el-pagination"),ee=u("el-dialog"),le=u("el-tree"),oe=u("el-drawer");return re(),se("div",null,[l(q,null,{default:o(()=>[l(V,{model:y.value,ref_key:"searchRoleFormRef",ref:b,inline:!0,style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(g,{label:"角色名称"},{default:o(()=>[l(a,{modelValue:y.value.roleName,"onUpdate:modelValue":e[0]||(e[0]=s=>y.value.roleName=s)},null,8,["modelValue"])]),_:1}),l(g,null,{default:o(()=>[l(c,{type:"primary",onClick:F},{default:o(()=>e[6]||(e[6]=[m(" 搜索 ")])),_:1}),l(c,{onClick:K},{default:o(()=>e[7]||(e[7]=[m("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(q,{shadow:"always"},{default:o(()=>[l(c,{type:"primary",size:"default",onClick:L},{default:o(()=>e[8]||(e[8]=[m(" 添加角色 ")])),_:1}),l(Y,{data:i(x),border:"",stripe:"","header-cell-style":{textAlign:"center"},"cell-style":{textAlign:"center"},style:{"margin-top":"10px"}},{default:o(()=>[l(R,{prop:"id",label:"ID"}),l(R,{prop:"roleName",label:"角色名称"}),l(R,{prop:"gmtCreate",label:"创建时间"}),l(R,{prop:"gmtModified",label:"修改时间"}),l(R,{label:"操作",width:"300px"},{default:o(s=>[l(c,{type:"success",size:"small",onClick:E=>Q(s.row)},{default:o(()=>e[9]||(e[9]=[m(" 分配权限 ")])),_:2},1032,["onClick"]),l(c,{type:"primary",size:"small",onClick:E=>M(s.row)},{default:o(()=>e[10]||(e[10]=[m(" 编辑 ")])),_:2},1032,["onClick"]),l(X,{title:"确定删除该角色吗？",onConfirm:E=>T(s.row)},{reference:o(()=>[l(c,{type:"danger",size:"small"},{default:o(()=>e[11]||(e[11]=[m("删除")])),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),l(Z,{onSizeChange:j,onCurrentChange:G,"page-sizes":[10,20,30,50],"page-size":i(w),layout:"prev, pager, next, jumper, -> , sizes, total",total:i(U),background:"",style:{margin:"10px 0"}},{default:o(()=>e[12]||(e[12]=[m(' :pager-count="7"> ')])),_:1},8,["page-size","total"])]),_:1}),l(ee,{modelValue:i(v),"onUpdate:modelValue":e[2]||(e[2]=s=>P(v)?v.value=s:v=s),title:i(r).id?"更新角色":"添加角色",width:"30%",onClose:S},{default:o(()=>[l(V,{model:i(r),ref_key:"saveOrUpdateRoleFormRef",ref:z,rules:B},{default:o(()=>[l(g,{label:"角色名称"},{default:o(()=>[l(a,{modelValue:i(r).roleName,"onUpdate:modelValue":e[1]||(e[1]=s=>i(r).roleName=s),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])]),_:1}),l(g,null,{default:o(()=>[l(c,{type:"primary",onClick:H},{default:o(()=>e[13]||(e[13]=[m("保存")])),_:1}),l(c,{onClick:S},{default:o(()=>e[14]||(e[14]=[m("取消")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(oe,{modelValue:i(p),"onUpdate:modelValue":e[5]||(e[5]=s=>P(p)?p.value=s:p=s),title:"分配角色权限",size:"30%","destroy-on-close":!0,"show-close":!0,wrapperClosable:!0},{default:o(()=>[l(V,null,{default:o(()=>[l(g,{label:"角色名称"},{default:o(()=>[l(a,{modelValue:i(r).roleName,"onUpdate:modelValue":e[3]||(e[3]=s=>i(r).roleName=s),clearable:"",disabled:!0},null,8,["modelValue"])]),_:1}),l(g,{label:"分配角色"},{default:o(()=>[l(le,{data:i(O),"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":i($),props:J,ref_key:"assignRolePermissionTreeRef",ref:N},null,8,["data","default-checked-keys"])]),_:1}),l(g,null,{default:o(()=>[l(c,{type:"primary",onClick:W},{default:o(()=>e[15]||(e[15]=[m(" 保存 ")])),_:1}),l(c,{onClick:e[4]||(e[4]=s=>P(p)?p.value=!1:p=!1)},{default:o(()=>e[16]||(e[16]=[m(" 取消 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{fe as default};
