import{K as U,d as we,r as u,B as be,u as Ue,L as N,e as m,M as ye,c as Q,o as R,b as l,w as t,k as d,z as T,q as H,h as r,A as _e,N as q,F as Ce,y as Ve,t as ke,U as C,O as i,P as A}from"./index-CDtMGLGq.js";import{n as Re,u as he}from"./user-K8Os8YIe.js";const xe=(n,k,y)=>U.get(`/admin/acl/user/${n}/${k}?username=${y}`),De=n=>n.id?U.put("/admin/acl/user/update",n):U.post("/admin/acl/user/save",n),Se=n=>U.delete(`/admin/acl/user/remove/${n}`),Ne=n=>U.get(`/admin/acl/user/toAssign/${n}`),qe=n=>U.post("/admin/acl/user/doAssignRole",n),Ae=n=>U.delete("/admin/acl/user/batchRemove",{data:n}),Fe=we({__name:"index",setup(n){const k=u(),y=u({username:""});let z=u([]),O=u(0),F=u(1),h=u(5);const f=async()=>{let a=await xe(F.value,h.value,y.value.username);a.code===C?(z.value=a.data.items,O.value=a.data.total):i.error("查询用户列表失败")};be(async()=>{await f()});const J=()=>{f()},W=()=>{k.value.resetFields(),f()},$=Ue(),X=async a=>{if(a.username===$.username){i.error("不能删除自己");return}(await Se(a.id)).code===C?(i.success("删除用户成功"),f()):i.error("删除用户失败")},Y=a=>{h.value=a,f()},Z=a=>{F.value=a,f()};let w=u(!1);const B=()=>({id:"",username:"",nickName:"",password:""});let o=u(B()),E=u();const ee=N(()=>{let a={username:[{required:!0,validator:he,trigger:"blur"}],nickName:[{required:!0,validator:Re,trigger:"blur"}]};return(!o.value.id||o.value.id==="")&&(a.password=[{required:!0,message:"请输入密码",trigger:"blur"}]),a}),le=()=>{o.value=B(),w.value=!0};let L=u([]);const ae=a=>{L.value=a},te=async()=>{const a=L.value.map(v=>v.id);if(!a||a.length===0){i.error("请选择要删除的用户");return}(await Ae(a)).code===C?(i.success("批量删除用户成功"),f()):i.error("批量删除用户失败")},se=a=>{o.value=A.cloneDeep(a),w.value=!0,I.value=a.username};let I=u("");const oe=()=>{E.value.validate(async a=>{a?(o.value.id&&(o.value.password=void 0),console.log("saveOrUpdateUserData.value",o.value),(await De(o.value)).code===C?(i.success(o.value.id?"更新用户成功":"添加用户成功"),x(),I.value===$.username?document.location.reload():f()):i.error(o.value.id?"更新用户失败":"添加用户失败")):i.error("请检查输入的数据")})},x=()=>{w.value=!1};let _=u(!1),p=u([]),V=u([]);const M=N(()=>p.value.length===V.value.length),re=N(()=>p.value.length>0&&p.value.length<V.value.length),ne=a=>{console.log(a),a?p.value=A.cloneDeep(V.value):p.value=[]},ue=async a=>{let e=await Ne(a);e.code===C?(p.value=e.data.assignRoles,V.value=e.data.allRolesList):i.error("获取用户角色失败")},de=a=>{p.value=a},ie=a=>{o.value=A.cloneDeep(a),ue(a.id),_.value=!0},D=()=>{_.value=!1},pe=async()=>{let a=p.value.map(v=>v.id);(await qe({userId:o.value.id,roleIdList:a})).code===C?(i.success("分配用户角色成功"),D(),f()):i.error("分配用户角色失败")};return(a,e)=>{const v=m("el-input"),b=m("el-form-item"),c=m("el-button"),S=m("el-form"),P=m("el-card"),g=m("el-table-column"),me=m("el-popconfirm"),ce=m("el-table"),fe=m("el-pagination"),j=m("el-drawer"),G=m("el-checkbox"),ve=m("el-checkbox-group"),ge=ye("has");return R(),Q("div",null,[l(P,{shadow:"always"},{default:t(()=>[l(S,{model:y.value,ref_key:"queryFormRef",ref:k,inline:!0,style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:t(()=>[l(b,{label:"用户名",prop:"username"},{default:t(()=>[l(v,{modelValue:y.value.username,"onUpdate:modelValue":e[0]||(e[0]=s=>y.value.username=s),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),l(b,null,{default:t(()=>[l(c,{type:"primary",onClick:J},{default:t(()=>e[9]||(e[9]=[d("查询")])),_:1}),l(c,{onClick:W},{default:t(()=>e[10]||(e[10]=[d("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(P,{shadow:"always"},{default:t(()=>[T((R(),H(c,{type:"primary",onClick:le},{default:t(()=>e[11]||(e[11]=[d(" 添加用户 ")])),_:1})),[[ge,"btn.User.add"]]),l(c,{type:"danger",onClick:te},{default:t(()=>e[12]||(e[12]=[d(" 批量删除 ")])),_:1}),l(ce,{data:r(z),border:"",stripe:"",style:{"margin-top":"10px"},onSelectionChange:ae},{default:t(()=>[l(g,{type:"selection",width:"80px"}),l(g,{type:"index",label:"序号",width:"80px"}),l(g,{prop:"id",label:"ID",width:"80px"}),l(g,{prop:"username",label:"用户名",width:"120px"}),l(g,{prop:"nickName",label:"昵称",width:"120px"}),l(g,{prop:"roleName",label:"用户角色",width:"120px","show-overflow-tooltip":""}),l(g,{prop:"gmtCreate",label:"创建时间",width:"120px","show-overflow-tooltip":""}),l(g,{prop:"gmtModified",label:"更新时间",width:"120px","show-overflow-tooltip":""}),l(g,{label:"操作",width:"220px",fixed:"right"},{default:t(s=>[l(c,{type:"success",size:"small",onClick:K=>ie(s.row)},{default:t(()=>e[13]||(e[13]=[d(" 分配角色 ")])),_:2},1032,["onClick"]),l(c,{type:"primary",size:"small",onClick:K=>se(s.row)},{default:t(()=>e[14]||(e[14]=[d(" 编辑 ")])),_:2},1032,["onClick"]),l(me,{title:"确定删除该用户吗？",onConfirm:K=>X(s.row)},{reference:t(()=>[l(c,{type:"danger",size:"small"},{default:t(()=>e[15]||(e[15]=[d("删除")])),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1}),l(fe,{onSizeChange:Y,onCurrentChange:Z,"page-sizes":[10,20,30,50],"page-size":r(h),layout:"prev, pager, next, jumper, -> , sizes, total",total:r(O),background:""},null,8,["page-size","total"]),l(j,{modelValue:r(w),"onUpdate:modelValue":e[4]||(e[4]=s=>q(w)?w.value=s:w=s),title:r(o).id?"编辑用户":"添加用户","before-close":x,"destroy-on-close":!0,"show-close":!0,wrapperClosable:!0},{footer:t(()=>[l(c,{onClick:x},{default:t(()=>e[16]||(e[16]=[d("取 消")])),_:1}),l(c,{type:"primary",onClick:oe},{default:t(()=>e[17]||(e[17]=[d("确 定")])),_:1})]),default:t(()=>[l(S,{model:r(o),ref_key:"saveOrUpdateUserFormRef",ref:E,rules:ee.value,"label-width":"100px"},{default:t(()=>[l(b,{label:"用户名",prop:"username"},{default:t(()=>[l(v,{modelValue:r(o).username,"onUpdate:modelValue":e[1]||(e[1]=s=>r(o).username=s),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),T(l(b,{prop:"password",label:"密码"},{default:t(()=>[l(v,{modelValue:r(o).password,"onUpdate:modelValue":e[2]||(e[2]=s=>r(o).password=s),type:"password","show-password":"",placeholder:"请输入密码",clearable:""},null,8,["modelValue"])]),_:1},512),[[_e,!r(o).id||r(o).id===""]]),l(b,{label:"昵称",prop:"nickName"},{default:t(()=>[l(v,{modelValue:r(o).nickName,"onUpdate:modelValue":e[3]||(e[3]=s=>r(o).nickName=s),placeholder:"请输入昵称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(j,{modelValue:r(_),"onUpdate:modelValue":e[8]||(e[8]=s=>q(_)?_.value=s:_=s),title:"分配用户角色","before-close":D,"destroy-on-close":!0,"show-close":!0,wrapperClosable:!0},{footer:t(()=>[l(c,{onClick:D},{default:t(()=>e[19]||(e[19]=[d("取 消")])),_:1}),l(c,{type:"primary",onClick:pe},{default:t(()=>e[20]||(e[20]=[d("确 定")])),_:1})]),default:t(()=>[l(S,{ref:"assignUserRolesFormRef"},{default:t(()=>[l(b,{label:"用户名"},{default:t(()=>[l(v,{modelValue:r(o).username,"onUpdate:modelValue":e[5]||(e[5]=s=>r(o).username=s),disabled:!0,clearable:""},null,8,["modelValue"])]),_:1}),l(b,{label:"角色选择"},{default:t(()=>[l(G,{modelValue:M.value,"onUpdate:modelValue":e[6]||(e[6]=s=>M.value=s),indeterminate:re.value,onChange:ne},{default:t(()=>e[18]||(e[18]=[d(" 全选 ")])),_:1},8,["modelValue","indeterminate"]),l(ve,{modelValue:r(p),"onUpdate:modelValue":e[7]||(e[7]=s=>q(p)?p.value=s:p=s),onChange:de},{default:t(()=>[(R(!0),Q(Ce,null,Ve(r(V),s=>(R(),H(G,{key:s.id,value:s},{default:t(()=>[d(ke(s.roleName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},512)]),_:1},8,["modelValue"])])}}});export{Fe as default};
